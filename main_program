#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed Jul 17 21:52:07 2019

@author: bhawik
"""
import requests
from bs4 import BeautifulSoup
import smtplib

URL = 'https://www.amazon.in/Yamaha-F310-6-Strings-Acoustic-Natural/dp/B000RVYW7E/ref=sr_1_4?keywords=yamaha+f310+acoustic+guitar&qid=1563380945&s=musical-instruments&sr=1-4'

headers = {"User-Agent": 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36'}


def check_price():
    page = requests.get(URL, headers=headers)
    
    soup = BeautifulSoup(page.content, 'html.parser')
    
    
    #print(soup.pretify())
    
    title = soup.find(id = "productTitle").get_text().strip()
    
    price  = soup.find(id = "priceblock_ourprice").get_text()
    
    #print(price[2])
    
    converted_price =  float(price[2] + price[4:7])
    
    
    if(converted_price < 8000):
        send_mail()
        
    
    
    print("Rs",converted_price)
    print(title.strip())
    
 #   if(converted_price < 8500):
  #      send_mail()    
    
def send_mail():
    server = smtplib.SMTP('smtp.gmail.com', 587)
    server.ehlo()
    server.starttls()
    server.ehlo()
    server.login('Admin or Sender's Email ID','Password generated by google')
    #vleqasqwishtfpgv
    
    subject = 'Price fell down!'
    body = 'Check the amazon link -> https://www.amazon.in/Yamaha-F310-6-Strings-Acoustic-Natural/dp/B000RVYW7E/ref=sr_1_4?keywords=yamaha+f310+acoustic+guitar&qid=1563380945&s=musical-instruments&sr=1-4'
    
    
    msg = f"Subject: {subject}\n\n{body}"
    
    server.sendmail(
            'Sender's E-mail ID',
            'Receiver's Email ID ',
            msg
            
            
            )
 
  
    
    
    print('HEY E-MAIL HAS BEEN SENT!')
    server.quit()
    
check_price()    
print("The code is finally updated")
